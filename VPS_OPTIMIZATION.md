# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è VPS 2 CPU / 4GB RAM

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –Ω–∞ VPS —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ (2 CPU, 4GB RAM) —Å–µ—Ä–≤–µ—Ä –∑–∞–≤–∏—Å–∞–ª –∏–∑-–∑–∞ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏.

## –†–µ—à–µ–Ω–∏—è

### 1. –£–º–µ–Ω—å—à–µ–Ω—ã Gunicorn –≤–æ—Ä–∫–µ—Ä—ã –∏ –ø–æ—Ç–æ–∫–∏
**–ë—ã–ª–æ:**
- Workers: 3
- Worker class: gthread
- Threads: 4
- –ò—Ç–æ–≥–æ: 3 –ø—Ä–æ—Ü–µ—Å—Å–∞ √ó 4 –ø–æ—Ç–æ–∫–∞ = 12 –ø–æ—Ç–æ–∫–æ–≤

**–°—Ç–∞–ª–æ:**
- Workers: 1
- Worker class: sync (–ª–µ–≥—á–µ —á–µ–º gthread)
- Threads: 2
- Max requests: 1000 (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞ –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏)
- –ò—Ç–æ–≥–æ: 1 –ø—Ä–æ—Ü–µ—Å—Å √ó 2 –ø–æ—Ç–æ–∫–∞ = 2 –ø–æ—Ç–æ–∫–∞

### 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ª–∏–º–∏—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤

| –°–µ—Ä–≤–∏—Å | CPU Limit | Memory Limit | CPU Reserve | Memory Reserve |
|--------|-----------|--------------|-------------|----------------|
| **Backend** | 1.0 | 1.5GB | 0.25 | 256MB |
| **Celery** | 0.5 | 512MB | 0.1 | 128MB |
| **Celery-Beat** | 0.25 | 256MB | 0.05 | 64MB |
| **Frontend** | 0.5 | 512MB | 0.1 | 128MB |
| **Redis** | 0.25 | 256MB | 0.05 | 64MB |
| **Nginx** | 0.25 | 128MB | 0.05 | 32MB |
| **–ò–¢–û–ì–û** | **2.75** | **~3.1GB** | **0.6** | **~640MB** |

### 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω Redis
- –£–º–µ–Ω—å—à–µ–Ω–∞ –ø–∞–º—è—Ç—å: 128MB (–±—ã–ª–æ 256MB)
- –û—Ç–∫–ª—é—á–µ–Ω—ã —á–∞—Å—Ç—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (save "")
- –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### 4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω Celery
- –£–º–µ–Ω—å—à–µ–Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è: `--concurrency=2` (–±—ã–ª–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –£–º–µ–Ω—å—à–µ–Ω prefetch: `--prefetch-multiplier=2`
- –£–º–µ–Ω—å—à–µ–Ω–æ max-tasks-per-child: 500 (–±—ã–ª–æ 1000)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: warning (–±—ã–ª–æ info)

### 5. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω entrypoint
- –î–æ–±–∞–≤–ª–µ–Ω `--clear` –¥–ª—è collectstatic (–º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏)
- –î–æ–±–∞–≤–ª–µ–Ω `--verbosity 0` (–º–µ–Ω—å—à–µ –≤—ã–≤–æ–¥–∞)

## –ò—Ç–æ–≥–æ–≤–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ

### CPU
- –ú–∞–∫—Å–∏–º—É–º: 2.75 CPU (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 2 CPU —Å –∑–∞–ø–∞—Å–æ–º –¥–ª—è —Å–∏—Å—Ç–µ–º—ã)
- –†–µ–∑–µ—Ä–≤: 0.6 CPU

### Memory
- –ú–∞–∫—Å–∏–º—É–º: ~3.1GB (–æ—Å—Ç–∞–µ—Ç—Å—è ~900MB –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∏ Docker)
- –†–µ–∑–µ—Ä–≤: ~640MB

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤ —á–µ—Ä–µ–∑ `docker stats`
2. **Swap**: –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏, –¥–æ–±–∞–≤—å—Ç–µ swap —Ñ–∞–π–ª:
   ```bash
   sudo fallocate -l 2G /swapfile
   sudo chmod 600 /swapfile
   sudo mkswap /swapfile
   sudo swapon /swapfile
   ```
3. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤**: –ï—Å–ª–∏ Celery –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å:
   ```yaml
   # –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ celery –∏ celery-beat –≤ docker-compose.coolify.yml
   ```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose -f docker-compose.coolify.yml logs --tail=50

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose -f docker-compose.coolify.yml ps
```

## –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –∑–∞–≤–∏—Å–∞–µ—Ç

1. –£–≤–µ–ª–∏—á—å—Ç–µ `start_period` –¥–ª—è healthcheck –¥–æ 120s
2. –û—Ç–∫–ª—é—á–∏—Ç–µ Celery –≤—Ä–µ–º–µ–Ω–Ω–æ
3. –£–º–µ–Ω—å—à–∏—Ç–µ workers –¥–æ 1 –∏ threads –¥–æ 1
4. –î–æ–±–∞–≤—å—Ç–µ swap —Ñ–∞–π–ª
