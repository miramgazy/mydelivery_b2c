# TG Delivery B2C — Презентация проекта

## 1. Что это

**Система заказов доставки еды** через **Telegram Mini App** с интеграцией **iiko**.  
Клиенты заказывают из приложения в Telegram; заказы уходят в iiko; админы управляют меню и заказами через веб-админку.

---

## 2. Стек

| Слой | Технологии |
|------|------------|
| **Frontend** | Vue 3, Vite, Pinia, Tailwind CSS, Telegram Web App SDK, Vue i18n |
| **Backend** | Django 5, DRF, JWT (Simple JWT), PostgreSQL 15, Redis 7, Celery |
| **Интеграция** | iiko API (меню, заказы, терминалы, улицы, типы оплаты) |
| **Инфра** | Docker Compose, Nginx, Coolify (деплой) |

---

## 3. Архитектура (упрощённо)

```
Telegram Mini App (Vue)  →  Nginx  →  Django API  →  PostgreSQL
                                    →  Celery     →  Redis
                                    →  iiko API   (внешний)
```

- **Пользователь**: входит по Telegram `initData`, получает JWT.
- **Меню и заказы**: хранятся в БД, синхронизация меню с iiko по расписанию (Celery Beat).
- **Создание заказа**: бэкенд собирает payload и отправляет в iiko `deliveries/create`.

---

## 4. Для клиента (Mini App)

- **Главная** — быстрый доступ к меню и разделам.
- **Меню** — категории, товары, модификаторы, стоп-лист.
- **Корзина и чекаут** — адрес доставки, комментарий, тип оплаты.
- **Заказы** — список и детали заказа, статусы.
- **Профиль** — адреса доставки, данные пользователя.
- **Онбординг** — по шагам: приветствие → телефон → адрес → выбор терминала (зоны доставки).
- **Быстрое меню** — отдельные группы товаров по короткой ссылке (`/fast-menu/:groupId`).

---

## 5. Для администратора (веб)

- **Организация**: настройки, терминалы, типы оплаты, зоны доставки.
- **Меню**: синхронизация с iiko, управление категориями/продуктами/модификаторами, стоп-лист.
- **Заказы**: список заказов, статусы.
- **Пользователи**: список и роли.
- **Быстрое меню**: группы товаров для коротких ссылок.

Роли: `superadmin`, `org_admin`, `customer`. Доступ в админку только у админов; в Mini App — все авторизованные.

---

## 6. Backend (модули)

| Приложение | Назначение |
|------------|------------|
| **users** | Пользователи, роли, Telegram-авторизация, адреса доставки, вебхук бота (при необходимости). |
| **organizations** | Организации, терминалы, улицы (iiko), типы оплаты. |
| **products** | Категории, продукты, модификаторы, стоп-лист, синхронизация с iiko. |
| **orders** | Создание/обновление заказов, статусы, отправка в iiko. |
| **iiko_integration** | HTTP-клиент и сервисы для iiko API. |

---

## 7. Запуск (локально)

```bash
cp env.b2c.template .env.b2c   # настроить SECRET_KEY, TELEGRAM_BOT_*, DB_*
docker-compose -f docker-compose.b2c.yml up -d --build
docker-compose -f docker-compose.b2c.yml exec backend python manage.py createsuperuser
```

- **Frontend**: http://localhost:3030  
- **API**: http://localhost:8090/api/  
- **Admin**: http://localhost:8090/admin/ (или /administrator/)

---

## 8. Полезные факты

- **Порты B2C**: frontend 3030, backend 8090, PostgreSQL 5436 (внешний).
- **Миграции** выполняются при старте backend (entrypoint).
- **Документация API**: Swagger — `/api/schema/swagger-ui/`, ReDoc — `/api/schema/redoc/`.
- **iiko**: заказы создаются через `POST api-ru.iiko.services/api/1/deliveries/create` (организация, терминал, товары, модификаторы, адрес, оплата).

---

*Кратко: Telegram Mini App для заказов еды, Django + iiko на бэкенде, админка на Vue, всё в Docker.*
