# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ iiko Delivery System

## –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot   ‚îÇ
‚îÇ   (Mini App)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ initData
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Vue Frontend  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ    Nginx     ‚îÇ
‚îÇ  (Docker)       ‚îÇ      ‚îÇ  (Optional)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                      ‚îÇ
         ‚îÇ REST API             ‚îÇ
         ‚Üì                      ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       Django Backend (Docker)        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ    API    ‚îÇ    ‚îÇ   Celery     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Views    ‚îÇ    ‚îÇ   Workers    ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ        ‚îÇ                 ‚îÇ          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üì‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üì‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ      Business Logic           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   (Services, Models)          ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                   ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚Üì‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚Üì‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ PostgreSQL‚îÇ        ‚îÇ Redis  ‚îÇ
    ‚îÇ  (Docker) ‚îÇ        ‚îÇ(Docker)‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
          ‚îÇ API Requests
          ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  iiko API   ‚îÇ
    ‚îÇ  (External) ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. Frontend (Vue 3)
**–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤**: –û—Ç–¥–µ–ª—å–Ω–æ–º Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
**–ü–æ—Ä—Ç**: 5173 (dev), 80/443 (prod)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**:
- Vue 3 (Composition API)
- Vue Router
- Pinia (State Management)
- Axios (HTTP –∫–ª–∏–µ–Ω—Ç)
- Tailwind CSS
- Telegram Web App SDK

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –ö–æ—Ä–∑–∏–Ω–∞ –∑–∞–∫–∞–∑–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 2. Backend (Django + DRF)
**–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤**: Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
**–ü–æ—Ä—Ç**: 8000
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**:
- Django 5.0
- Django REST Framework
- PostgreSQL
- Celery + Redis
- JWT Authentication

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏**:

#### apps/users/
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –†–æ–ª–∏ (superadmin, org_admin, customer)
- Telegram –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏

#### apps/organizations/
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ (—Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏)
- –¢–µ—Ä–º–∏–Ω–∞–ª—ã
- –£–ª–∏—Ü—ã –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏
- –¢–∏–ø—ã –æ–ø–ª–∞—Ç—ã

#### apps/products/
- –ú–µ–Ω—é
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- –ü—Ä–æ–¥—É–∫—Ç—ã —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏
- –°—Ç–æ–ø-–ª–∏—Å—Ç (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã)

#### apps/orders/
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko

#### apps/iiko_integration/
- HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è iiko API
- –°–µ—Ä–≤–∏—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)
**–í–µ—Ä—Å–∏—è**: 15
**–ü–æ—Ä—Ç**: 5432

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**:
- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `roles` - –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `organizations` - –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã
- `products` - –ü—Ä–æ–¥—É–∫—Ç—ã/–±–ª—é–¥–∞
- `modifiers` - –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- `stop_list` - –°—Ç–æ–ø-–ª–∏—Å—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- `orders` - –ó–∞–∫–∞–∑—ã
- `order_items` - –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤
- `delivery_addresses` - –ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- `payment_types` - –¢–∏–ø—ã –æ–ø–ª–∞—Ç—ã

**–ò–Ω–¥–µ–∫—Å—ã**:
- –ü–æ telegram_id –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ organization –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ created_at –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∑–∞–∫–∞–∑–æ–≤

### 4. Redis
**–í–µ—Ä—Å–∏—è**: 7
**–ü–æ—Ä—Ç**: 6379

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- Message Broker –¥–ª—è Celery
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–¥–∞—á Celery

### 5. Celery
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- **Worker**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- **Beat**: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

**–ó–∞–¥–∞—á–∏**:
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é —Å iiko
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
Telegram Mini App
    ‚Üì (initData)
Frontend –ø–æ–ª—É—á–∞–µ—Ç initData
    ‚Üì (POST /api/auth/telegram/)
Backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç initData
    ‚Üì (–ø—Ä–æ–≤–µ—Ä–∫–∞ HMAC-SHA256)
Backend —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚Üì (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è JWT)
Frontend –ø–æ–ª—É—á–∞–µ—Ç access + refresh —Ç–æ–∫–µ–Ω—ã
    ‚Üì
Frontend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ –ø–∞–º—è—Ç–∏
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```
–ö–ª–∏–µ–Ω—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ—Ä–∑–∏–Ω—É
    ‚Üì
Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑
    ‚Üì (POST /api/orders/)
Backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ:
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–æ–ø-–ª–∏—Å—Ç
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
    ‚Üì
Backend —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –≤ –ë–î
    ‚Üì
OrderService —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è iiko
    ‚Üì (POST iiko API /deliveries/create)
iiko —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–∫–∏
    ‚Üì (response with orderId)
Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑:
  - iiko_order_id
  - order_number
  - status = confirmed
    ‚Üì
Frontend –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–Ω—é

```
Frontend –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–µ–Ω—é
    ‚Üì (GET /api/products/)
Backend —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç:
  - –ü–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –¢–æ–ª—å–∫–æ is_available=true
  - –ò—Å–∫–ª—é—á–∞–µ—Ç —Å—Ç–æ–ø-–ª–∏—Å—Ç
    ‚Üì
Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
  - –ü—Ä–æ–¥—É–∫—Ç—ã
  - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
  - –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
  - –¶–µ–Ω—ã
    ‚Üì
Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –º–µ–Ω—é
```

## API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```
POST   /api/auth/telegram/           # –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram
POST   /api/token/                   # –ü–æ–ª—É—á–∏—Ç—å JWT —Ç–æ–∫–µ–Ω
POST   /api/token/refresh/           # –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```
GET    /api/users/                   # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
POST   /api/users/                   # –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /api/users/{id}/              # –î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
PUT    /api/users/{id}/              # –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DELETE /api/users/{id}/              # –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /api/users/me/                # –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
PUT    /api/users/me/                # –û–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
```

### –ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
```
GET    /api/delivery-addresses/      # –°–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤
POST   /api/delivery-addresses/      # –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å
GET    /api/delivery-addresses/{id}/ # –î–µ—Ç–∞–ª–∏ –∞–¥—Ä–µ—Å–∞
PUT    /api/delivery-addresses/{id}/ # –û–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å
DELETE /api/delivery-addresses/{id}/ # –£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å
POST   /api/delivery-addresses/{id}/set_default/ # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

### –ü—Ä–æ–¥—É–∫—Ç—ã
```
GET    /api/products/                # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
GET    /api/products/{id}/           # –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
GET    /api/categories/              # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
GET    /api/menus/                   # –ú–µ–Ω—é
```

### –°—Ç–æ–ø-–ª–∏—Å—Ç
```
GET    /api/stop-list/               # –°–ø–∏—Å–æ–∫ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)
POST   /api/stop-list/               # –î–æ–±–∞–≤–∏—Ç—å –≤ —Å—Ç–æ–ø-–ª–∏—Å—Ç
DELETE /api/stop-list/{id}/          # –£–¥–∞–ª–∏—Ç—å –∏–∑ —Å—Ç–æ–ø-–ª–∏—Å—Ç–∞
```

### –ó–∞–∫–∞–∑—ã
```
GET    /api/orders/                  # –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
POST   /api/orders/                  # –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
GET    /api/orders/{id}/             # –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
GET    /api/orders/{id}/status/      # –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏–∑ iiko
POST   /api/orders/{id}/cancel/      # –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
GET    /api/orders/my_orders/        # –ú–æ–∏ –∑–∞–∫–∞–∑—ã
GET    /api/orders/statistics/       # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∞–¥–º–∏–Ω—ã)
```

## –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –†–æ–ª–∏

#### 1. Superadmin
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º
- –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤

#### 2. Org Admin
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–≤–æ–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ø-–ª–∏—Å—Ç–æ–º
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

#### 3. Customer
- –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–Ω—é
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∑–∞–∫–∞–∑–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏–º–∏ –∞–¥—Ä–µ—Å–∞–º–∏

### –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∞–≤

| –î–µ–π—Å—Ç–≤–∏–µ | Superadmin | Org Admin | Customer |
|----------|------------|-----------|----------|
| –°–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é | ‚úÖ | ‚ùå | ‚ùå |
| –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ | ‚úÖ | ‚ùå | ‚ùå |
| –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | ‚úÖ* | ‚ùå |
| –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | ‚úÖ | ‚úÖ* | ‚ùå |
| –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ–Ω—é | ‚úÖ | ‚úÖ | ‚úÖ |
| –£–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–æ–ø-–ª–∏—Å—Ç–æ–º | ‚úÖ | ‚úÖ | ‚ùå |
| –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã | ‚úÖ | ‚úÖ* | ‚ùå |
| –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã | ‚úÖ | ‚úÖ | ‚úÖ |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ‚úÖ | ‚úÖ* | ‚ùå |

*—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ API endpoints iiko

```
POST /api/1/access_token             # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
POST /api/1/organizations            # –°–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
POST /api/1/terminal_groups          # –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã
POST /api/1/nomenclature             # –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–Ω—é
POST /api/1/payment_types            # –¢–∏–ø—ã –æ–ø–ª–∞—Ç—ã
POST /api/1/streets/by_city          # –°–ø–∏—Å–æ–∫ —É–ª–∏—Ü
POST /api/1/deliveries/create        # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
POST /api/1/deliveries/by_id         # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
```

### –§–æ—Ä–º–∞—Ç –∑–∞–∫–∞–∑–∞ –¥–ª—è iiko

```json
{
  "organizationId": "uuid",
  "terminalGroupId": "uuid",
  "order": {
    "orderServiceType": "DeliveryByCourier",
    "status": "Unconfirmed",
    "customer": {
      "id": "uuid",
      "name": "–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞"
    },
    "phone": "+77779285899",
    "deliveryPoint": {
      "type": "coordinates",
      "coordinates": {
        "latitude": 50.257094,
        "longitude": 57.243111
      },
      "address": {
        "city": "–ê–∫—Ç–æ–±–µ",
        "street": {
          "id": "uuid"
        },
        "house": "31–ê",
        "flat": "40"
      }
    },
    "items": [
      {
        "type": "Product",
        "productId": "uuid",
        "amount": 1,
        "price": 2550,
        "modifiers": [
          {
            "modifierId": "uuid",
            "amount": 1,
            "price": 100
          }
        ]
      }
    ],
    "customerPayments": [
      {
        "paymentTypeId": "uuid",
        "sum": 2550
      }
    ]
  }
}
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è Telegram
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ HMAC-SHA256
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö–µ—à–µ–π —Å –ø–æ–º–æ—â—å—é `hmac.compare_digest()`

### 2. JWT –¢–æ–∫–µ–Ω—ã
- Access token: 24 —á–∞—Å–∞
- Refresh token: 7 –¥–Ω–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è refresh —Ç–æ–∫–µ–Ω–æ–≤
- Blacklist –¥–ª—è –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

### 3. API
- HTTPS –≤ production
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- Rate limiting (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- Prepared statements (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection)
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ

#### Backend
```yaml
# docker-compose.yml
backend:
  deploy:
    replicas: 3  # –ù–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
```

#### Celery Workers
```yaml
celery:
  deploy:
    replicas: 5  # –ë–æ–ª—å—à–µ –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
```

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ

```yaml
backend:
  deploy:
    resources:
      limits:
        cpus: '2'
        memory: 2G
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–∏—Ç—å Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è:
- –ú–µ–Ω—é (TTL: 5 –º–∏–Ω—É—Ç)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (TTL: 10 –º–∏–Ω—É—Ç)
- –°–ø–∏—Å–∫–∞ —É–ª–∏—Ü (TTL: 1 —á–∞—Å)

```python
# settings.py
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://redis:6379/1',
    }
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

1. **Sentry** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
2. **Prometheus + Grafana** - –º–µ—Ç—Ä–∏–∫–∏
3. **ELK Stack** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
4. **Uptime Robot** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –≤ —á–∞—Å
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ iiko
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (CPU, RAM)
- –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –ë—ç–∫–∞–ø—ã

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ç–∫–∞–ø
0 2 * * * docker-compose exec -T db pg_dump -U postgres iiko_delivery | gzip > /backups/db_$(date +\%Y\%m\%d).sql.gz

# –•—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
find /backups -name "db_*.sql.gz" -mtime +30 -delete
```

### –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã

```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å S3
aws s3 sync /app/media s3://your-bucket/media --delete
```

## Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### Database

1. **–ò–Ω–¥–µ–∫—Å—ã**:
   - `telegram_id` (UNIQUE)
   - `organization_id`
   - `created_at`
   - composite –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

2. **Query –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
   - `select_related()` –¥–ª—è foreign keys
   - `prefetch_related()` –¥–ª—è many-to-many
   - `only()` / `defer()` –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π

3. **Connection pooling**:
   ```python
   DATABASES = {
       'default': {
           'CONN_MAX_AGE': 600,
       }
   }
   ```

### API

1. **Pagination**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
2. **Compression**: Gzip —Å–∂–∞—Ç–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
3. **Caching**: Redis –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### Frontend

1. **Code splitting**: Lazy loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. **Image optimization**: WebP —Ñ–æ—Ä–º–∞—Ç, lazy loading
3. **Bundle optimization**: Tree shaking, minification